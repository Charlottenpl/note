## 防沉迷sdk

---

- 实名认证接口

  仅用于进行实名认证，并返回认证结果，不做防沉迷相关操作

  isGuest可以控制实名认证框能否关闭，如果关闭就是在游客状态游玩，不能关闭就只能先实名认证之后才可以关掉弹窗 
  
  默认false

```
/**
 * 判断是否需要实名认证接口，如果需要则弹出实名认证弹窗。
 * @param activity  上下文
 * @param isGuest  是否支持游客登录，true：实名认证弹窗右上角❎可以关闭  false：实名认证弹窗右上角❎不可以关闭
 * @param callback  实名认证回调
 * @return
 */
public boolean needRealName(Activity activity, boolean isGuest, RealNameCallBack callback) {
```

- 防沉迷接口

  通过返回的实名认证状态进行判断是否需要弹出防沉迷的弹窗，防沉迷弹窗不可以关闭

  累积游戏时长，仅用于游客状态的玩家，剩余时间不足之后就会弹出防沉迷弹窗（现在默认累计时长通过参数传进来，所以sdk中没有相关的时长刷新逻辑，比如，15天内累积游戏时间不超过1小时，15天之后刷新累积时长，只是运行了一个计时任务，每秒累积时长加一，当累积时长大于60*60的时候弹窗）
  
  时长绑定在身份证
  
  实名绑定在账号上

```
/**
 * 0：未成年玩家：仅在周五、周六、周日和法定节假日的20时至21时可以登录游戏
 * @param activity  上下文
 * @param realName  当前账号实名认证状态：Adult，Young，Guest（）
 * @param duration  当前账号累积游玩时长（单位s，仅用于游客账号）
 * @param callBack  防沉迷回调
 */
public void registerTimeLimit(Activity activity,int realName, int duration, TimeLimitCallBack callBack) {
```

相关政策：http://www.gov.cn/zhengce/zhengceku/2021-09/01/content_5634661.htm

sdk：

- 做两版sdk，
  - 国内：没有游客身份，必须进行实名认证
  - 国外：有游客身份
- 添加统计时长功能
- 节假日通过后端接口获取，设置过期时长，到期重新获取节假日信息
- 实名认证弹窗去掉关闭按钮，默认不可以关闭
- 时长绑定在身份证，实名认证的时候对身份证进行hash，传入后端保存，下次实名认证的时候需要先进行hash然后传给后端判断是否已经存在。
- 实名认证状态存到账号里



身份证hash

生日





国内不提供游客

国外提供游客身份

统计时长

节假日通过服务器获取，缓存到本地

时长绑定在身份证，实名认证的时候对身份证进行hash，传入后端保存，下次实名认证的时候需要先进行hash然后传给后端判断是否已经存在。（如果出现hash冲突咋办）

实名绑定在账号上，









### 防沉迷接口思路

---

调用防沉迷接口，获取当前userid，根据userid查询当前实名认证状态

- 游客

  每隔15天重置一次时长限制为1小时

- 未成年

  查看是否在限制时间段内

- 成年人

  无限制，放开玩

如果没登录则返回请先登录

如果登录了则获取当前账号的状态，根据状态选择策略

---

游客的话需要累积时长，

if 游客累积时长不超过1小时

​	return

else 游客累积时长到达1小时

​	if 第一次登录至今满15天

​		刷新累积时长和第一次登录时间，重新计时

​	else 

​		限制时间
